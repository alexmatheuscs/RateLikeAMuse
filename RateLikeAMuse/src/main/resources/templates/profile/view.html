<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${'Perfil de ' + #authentication.principal.username}">Meu Perfil - Rate Like a Muse</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body class="black-background">

    <div class="header">
        <div sec:authorize="isAuthenticated()">
            <a th:href="@{/movies}" class="perfil-btn">Ver Filmes</a>
            <form th:action="@{/logout}" method="post" style="display: inline;">
                <button type="submit" class="logout-btn">Sair</button>
            </form>
        </div>
    </div>

    <div class="logo-wrapper">
        <img th:src="@{/images/logo2.png}" alt="Logo" class="responsive-logo">
    </div>

    <div class="container">
        
        <div th:if="${param.success}" class="success-message">
            <p>Perfil atualizado com sucesso!</p>
        </div>

        <h1 class="title" th:text="${'Perfil de ' + #authentication.principal.username}">Nome do Usuário</h1>
        
        <a th:href="@{/profile/edit/{username}(username=${#authentication.principal.username})}" class="submit-btn" style="margin-bottom: 40px;">Editar Perfil</a>

        <hr class="divider">

        <h2 class="title" style="margin-top: 20px;">Meu Histórico de Avaliações</h2>

        <div class="card-list">
            
            <div th:if="${!rates.isEmpty()}" th:each="rate : ${rates}" class="movie-card">
                <div th:with="movie=${movieMap.get(rate.movieId)}">
                    <div class="card-header">
                        <h3 th:text="${movie != null ? movie.nome : 'Filme não encontrado'}">Nome do Filme</h3>
                        <span class="year" th:text="${movie != null ? movie.ano : ''}">2024</span>
                    </div>
                    <div class="card-body">
                        <div class="text-content">
                            <p class="genre" th:text="${movie != null ? movie.genero : ''}">Gênero</p>
                            
                            <div class="rating-display">
                                <span th:each="i : ${#numbers.sequence(1, 5)}" 
                                      th:class="${i <= rate.score ? 'star filled' : 'star'}">★</span>
                            </div>
                            <p style="color: #ccc; font-size: 0.95rem;" 
                               th:text="${'Sua nota: ' + rate.score + ' estrela' + (rate.score > 1 ? 's' : '')}">
                               Sua nota: 5 estrelas
                            </p>
                        </div>
                        <img th:if="${movie != null}" th:src="@{/images/poster-movies/{poster}(poster=${movie.posterUrl})}" 
                             th:alt="${'Capa do filme ' + movie.nome}" 
                             class="movie-poster">
                    </div>
                </div>
            </div>

            <div th:if="${rates.isEmpty()}">
                <p style="color: #ccc; font-size: 1.1rem; text-align: center;">Você ainda não avaliou nenhum filme.</p>
            </div>
        </div>
    </div>

</body>
</html>